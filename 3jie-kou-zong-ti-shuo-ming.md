## 3**.1 请求URL地址** {#11-请求url地址}

平台api服务对外提供两套环境:

* **测试环境:待定**
* **生产环境:待定**

## 3.2 调用流程

符合接入条件后,合作机构调用流程如下图所示,主要的流程为:拼接 API 接 口输入参数;根据合作机构的私钥,生成签名;拼装 HTTP 请求参数;完成调 用,发送 HTTP 请求;最终接收服务端返回的 HTTP 响应,并完成解析。![](/assets/process.png)其中客户端可以为合作机构,也可以是钱站平台。相应的,服务端可以为钱站 平台,也可以是合作机构。 下面以合作机构作为客户端、钱站作为服务端作 为例子,具体讲解调用流程。反之亦然。

## 3.3 数据交互规范

* 使用POST方式发送请求;

* 钱站系统服务端参数值和返回的数据均为UTF-8编码，返回数据使用JSON格式;

* 通过RSA非对称加解密算法完成数据签名;

* 请求的所有参数通过数据签名算法生成签名字符串sign及钱站平台提供的channel\_key随其它参数一起发送到服务端

* 数据通讯采用HTTPS协议

## 3.4请求参数规范

| **参数名称** | **类型** | **是否必传** | **说明** |
| :--- | :--- | :--- | :--- |
| method | String | 是 | 要请求的API方法名称 |
| sign | String | 是 | RSA生成的数据签名串 |
| sign\_type | String | 是 | 签名类型,目前仅支持RSA |
| req\_data | String | 是 | 请求的业务数据,数据格式为Json。具 体参数说明见详细接口\[req\_data**数据报文说明**\] |
| req\_enc | String | 否 | req\_data加密方式\(0不加密,1加密:采用DES加密算法\),默认值:0 |
| des\_key | String | 否 | req\_enc为1时必传,DES解密使用\(该 字符串需要使用钱站平台的公钥进行RSA加密\) |
| channel\_key | String | 否 | 钱站平台分配给合作机构的唯一标识 |
| version | String | 是 | API协议版本,默认值:1.0 |
| format | String | 是 | 响应格式,目前仅支持JSON |
| timestamp | String | 是 | 10位时间戳,精确到秒 |
| return\_url | String | 否 | 回调url |

## 3.5响应参数规范

| **参数名称** | **类型** | **是否必传** | **说明** |
| :--- | :--- | :--- | :--- |
| code | String | 是 | 响应code码,200成功,非200为异 常情况 |
| msg | String | 是 | 响应的消息,如请求失败的原因等 |
| data | String | 否 | 该字段的数据类型根据具体的接口返回相应的数据类型 |

示例:{

“code”:200, “msg”:”请求成功”, “data”:{},

}

## 3.6数据签名算法

为了防止 API 接口调用过程中被黑客篡改内容,或非合作机构恶意调用 API 接 口对服务端进行攻击,调用任何一个 API 时都需要携带签名,钱站平台服务端 会根据请求参数,对签名进行验证,签名不合规的请求将被拒绝。目前平台仅 支持 RSA 签名算法。

**合作机构需要配合完成的签名过程:**

* 对 3.4 中的接口请求参数名\(不包含签名参数 sign,des\_key, return\_url\),根据字母 ASCII 码顺序对参数名称进行排序\(升序\)。 其中 req\_data 进行 json 编码\(结果: req\_data={“”:””,””:””}\),req\_data 作为一个整体参与排序。
* 将排序好的参数名和参数值按照 key1=value1&key2=value2 的方式 拼接,拼接后的字符串即为待签名字符串。

* 对待签名的字符串,根据合作机构的私钥,通过 RSA 签名,生成 sign。

* 对生成的签名 sign 进行 base64 编码。

* 最终将以上得到的参数\(sign\)拼装到请求中,发起 HTTP 请求。

**钱站平台验证流程:**

* 按照机构上方第 1、2 步流程拼接参数
* 根据 channel\_key 获取对应机构的公钥,根据公钥进行签名sign验证

## 3.7 RSA密钥生成方法

通过 openssl 工具生成 RSA 的公钥和私钥。

* 生成私钥:openssl genrsa -out rsa\_private\_key.pem 1024
* 生成公钥:openssl rsa -in rsa\_private\_key.pem -pubout -out rsa\_public\_key.pem

## 3.8业务数据加密算法

目前提供两种业务数据处理方式:

1. 不加密,仅完成签名\(biz\_enc=0\)
2. 加密,同时完成签名\(biz\_enc=1\)

**在数据签名前,合作机构需要完成的数据加密流程如下:**

* 合作方生成一个原始值 key,使用 key 对原始业务参数值\(即 req\_data\)进行 DES 加密算法,得到最终的 req\_data 参数值。

* 随后根据 3.6 中的签名算法,根据请求参数生成签名 sign。其中 req\_data 数值为上一步操作后得到的结果值。

* 将原始 key,根据钱站平台提供的公钥使用 RSA 加密算法生成 des\_key

* 最终将以上得到的参数\(req\_data,sign,des\_key\)拼装在请求 参数中,发起 HTTP 请求。

**钱站平台解密和验证流程:**

* 数据签名验证流程:签名验证流程与 3.6 中的验证流程一致。验证成功后,操作解密。

* 解密流程:

  ```
          （1）通过钱站私钥使用 RSA 解密算法,将 des_key 解密,得到及后开始的key。 

          （2）使用原始的 key 值,通过 DES 解密算法解密,得到原始的业务参数值req_data       
  ```



